# Master/Worker 主从网络处理架构实现

## 功能点

- [X] Master 接受 Socket 连接，负载均衡使用轮询法，分发给 Worker，Worker 处理具体业务。  
- [X]  监听 Worker 状态，如果 Worker 发生异常退出之后，Master 重启一个进程。
- [X] 一个 Worker 的最大服务次数为2次，达到最大次数后自动推出，Matster 监听 Worker 退出会重启一个进程。

## 快速开始

- 执行 `npm install` 安装依赖。  
- 终端执行 `npm run server`，启动 `server` 服务。  

- 打开 [WebSocket 测试网页](http://coolaf.com/tool/chattest)，输入 `ws://localhost:8001`，点击连接。
- 发送消息，客户端消息交互示例如下：

```bash
连接成功，现在你可以发送信息啦！！！
你发送的信息 2021-08-18 20:31:37
13
服务端回应 2021-08-18 20:31:37
1 号机器人 8792 处理 13 中...
服务端回应 2021-08-18 20:31:38
1 号机器人 8792 处理 13 完毕，结果为 13
你发送的信息 2021-08-18 20:31:41
13 * 2
服务端回应 2021-08-18 20:31:41
2 号机器人 16896 处理 13 * 2 中...
服务端回应 2021-08-18 20:31:42
2 号机器人 16896 处理 13 * 2 完毕，结果为 26
你发送的信息 2021-08-18 20:31:55
"asdasd" + 'dsas'
服务端回应 2021-08-18 20:31:55
1 号机器人 8792 处理 "asdasd" + 'dsas' 中...
服务端回应 2021-08-18 20:31:56
1 号机器人 8792 处理 "asdasd" + 'dsas' 完毕，结果为 asdasddsas
你发送的信息 2021-08-18 20:32:00
123132
服务端回应 2021-08-18 20:32:00
2 号机器人 16896 处理 123132 中...
服务端回应 2021-08-18 20:32:01
2 号机器人 16896 处理 123132 完毕，结果为 123132
你发送的信息 2021-08-18 20:32:02
3321
服务端回应 2021-08-18 20:32:02
3 号机器人 15396 处理 3321 中...
服务端回应 2021-08-18 20:32:03
3 号机器人 15396 处理 3321 完毕，结果为 3321
你发送的信息 2021-08-18 20:32:05
312231
服务端回应 2021-08-18 20:32:05
4 号机器人 9520 处理 312231 中...
服务端回应 2021-08-18 20:32:06
4 号机器人 9520 处理 312231 完毕，结果为 312231
你发送的信息 2021-08-18 20:32:06
31
服务端回应 2021-08-18 20:32:06
3 号机器人 15396 处理 31 中...
服务端回应 2021-08-18 20:32:07
3 号机器人 15396 处理 31 完毕，结果为 31
你发送的信息 2021-08-18 20:32:09
32154
服务端回应 2021-08-18 20:32:09
4 号机器人 9520 处理 32154 中...
服务端回应 2021-08-18 20:32:10
4 号机器人 9520 处理 32154 完毕，结果为 32154
你发送的信息 2021-08-18 20:32:10
5464
服务端回应 2021-08-18 20:32:10
5 号机器人 2492 处理 5464 中...
服务端回应 2021-08-18 20:32:11
5 号机器人 2492 处理 5464 完毕，结果为 5464
```

- 服务端日志示例如下:

```bash
Primary 11416 is running
Dispatch to 1
Dispatch to 2
Dispatch to 1
worker 1 success!
worker 8792 died
Dispatch to 2
worker 2 success!
worker 16896 died
Dispatch to 3
Dispatch to 4
Dispatch to 3
worker 3 success!
worker 15396 died
Dispatch to 4
worker 4 success!
worker 9520 died
Dispatch to 5
```